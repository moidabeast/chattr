# Anonymous Chat Application with Chat Lobby

## Overview
A real-time chat application with a lobby system that allows users to browse and join different chatrooms anonymously. Users can create new chatrooms with topics, descriptions, categories, and media (uploaded images, YouTube videos, Twitch videos, or Twitter posts), then participate in anonymous conversations within each room. Users can also post images, YouTube videos, Twitch videos, and Twitter posts directly in chat messages. The application includes search functionality, content moderation, emoji reactions, and a comprehensive Telegram-style threaded reply system for enhanced user interaction.

## Core Features

### Header Component Styling
- Header displays logo icon and title text with exactly 0.5rem spacing between them
- Spacing between logo icon and title text is consistent and responsive across mobile and desktop breakpoints
- Logo-to-title spacing adjustment does not affect positioning or layout of other header elements (navigation buttons, avatar, username button, etc.)
- All other header elements maintain their existing spacing and alignment

### Chat Lobby System
- Landing page displays a 4chan-style board layout with responsive grid system:
  - Desktop: 7 columns grid with square aspect ratio thumbnails
  - Mobile: 2-column grid for better space utilization and readability
- Lobby page displays the text "Join or create anonymous chats" with consistent styling and font matching the rest of the interface
- Each chatroom card shows topic, description, category tags, square thumbnail preview of the media, message counter, view counter, and live indicator with compact formatting
- Message counter displays the total number of messages in that chatroom
- View counter displays the total number of times the chatroom has been opened
- Live indicator displays a "LIVE" badge with compact user count formatting (e.g., "2.5k LIVE", "1.2M LIVE") when there are active users currently in the chatroom
- Live user count uses compact number formatting for readability (k for thousands, M for millions)
- Active users are determined by activity within the past 60 seconds (1 minute timeout)
- Category tags are displayed as small badges on chatroom cards for easy identification
- Counters and live indicator are displayed clearly below the thumbnail/media area on each chatroom card
- For uploaded images: display the image directly as square thumbnail
- For YouTube videos: display dynamic video thumbnail preview fetched from YouTube's standard thumbnail URL pattern (`https://img.youtube.com/vi/[VIDEO_ID]/hqdefault.jpg`) as square thumbnail
- For Twitch videos: display dynamic Twitch video thumbnail preview using correct Twitch thumbnail URLs:
  - Live streams: `https://static-cdn.jtvnw.net/previews-ttv/live_user_{channel_name}-640x360.jpg`
  - Clips: `https://clips.twitch.tv/{clipSlug}-preview-480x272.jpg`
  - VODs: Proper Twitch API endpoints for VOD thumbnails
- For Twitter posts: display Twitter post preview using `https://publish.twitter.com/oembed` API to extract preview image or fallback thumbnail as square thumbnail
- Clicking a chatroom card navigates to that specific chat interface and increments the view counter
- Clean, organized visual presentation of available chatrooms with dynamic media thumbnails, activity counters, category tags, and live status indicators
- Responsive grid layout that smoothly transitions between desktop (7-column) and mobile (2-column) layouts
- Robust loading states and error handling with fallback messaging when no chatrooms exist
- Display "No chatrooms found yet" message when the lobby is empty instead of indefinite loading
- Flat, modern appearance without card-style borders, shadows, or background colors on chatroom items across both desktop and mobile, similar to Twitch or Kick streaming platforms
- Preserve thumbnails, hover states, and grid responsiveness while maintaining the flatter visual design
- No limit on the number of chatrooms that can be displayed or created (infinite rooms support)
- Desktop typography: chatroom titles use 1rem font size, descriptions/counters/timestamps use 0.875rem font size
- Timestamp formatting displays relative time without the word "about" (e.g., "2 hours ago" instead of "about 2 hours ago")
- Fallback thumbnail handling for unsupported or missing media with appropriate placeholder images

### Chatroom Search and Filtering
- Search functionality allows users to find chatrooms by topic, description, or creator username
- Search input field prominently displayed in the lobby interface with persistent input focus and live debounce for improved stability and accuracy
- Real-time search results that filter the chatroom grid as users type
- Category filtering system with clickable category tags to show only chatrooms in specific categories including Finance
- Combined search and filter functionality allowing users to search within specific categories including the Finance category
- Clear search and filter reset options to return to full chatroom listing
- Search results maintain the same responsive grid layout and visual styling as the main lobby

### Live Activity Indicator
- Real-time "LIVE" badge appears on chatroom thumbnails when there are active users in the room
- Active users are determined by recent activity signals including active viewing or message posting within 60 seconds (1 minute timeout)
- Live indicator displays as a small "LIVE" badge with compact user count formatting (e.g., "2.5k LIVE", "1.2M LIVE") positioned over the thumbnail using the app's theme blue color
- Badge appears clearly but unobtrusively without disrupting the existing flat lobby design
- Badge automatically disappears when no active users remain in the chatroom
- Live status updates in real-time as users enter, leave, or become inactive in chatrooms
- Consistent styling with the current Twitch-like flat design aesthetic
- Live timeout reduced to 1 minute for more responsive activity tracking

### Chatroom Creation
- Form interface to create new chatrooms with required fields including mandatory media and category selection
- Topic field (required text input)
- Description field (required text input)
- Category selection (required dropdown or input field with predefined categories including Finance)
- Media selection with four tabs:
  - Text tab: For text-only messages
  - Image tab: Accept image files up to 10 MB regardless of file extension for direct upload
  - Video tab: Unified tab that accepts both YouTube (youtube.com, youtu.be) and Twitch (twitch.tv, clips.twitch.tv) video URLs with automatic detection and processing
  - Twitter tab: Accept Twitter post URLs (twitter.com, x.com) with full Twitter embed integration
- Video tab automatically detects whether pasted URLs are from YouTube or Twitch and processes them using the appropriate embedding logic
- Twitter tab integrates Twitter's widgets.js for full embedded tweet rendering with responsive display and theme support
- Form validation ensures valid media is provided from supported sources and category is selected including the Finance category
- Create button displays "Create Chat" text with plus icon
- When a chatroom is created, the uploaded image or media link is automatically posted as the first message in the chatroom by the room creator
- Newly created chatrooms appear immediately in the lobby grid with appropriate dynamic media preview, category tags including Finance, and initialized counters (0 messages, 0 views)
- Form validation and user feedback for successful creation, media validation, and category selection
- No limit on the number of chatrooms that can be created

### Anonymous User System
- No authentication or login required across the entire application
- Automatic generation of random anonymous IDs (e.g., "Anon1234") for users who don't set a username
- Optional custom username setting that persists in browser session via localStorage
- Username synchronization: when a user updates their username, all their previously posted messages across all chatrooms are automatically updated to reflect the new name retroactively
- Users can chat immediately in any chatroom without setup process
- Avatar selection system allowing users to upload custom avatars or choose from preset options
- Avatar images persist in browser session and display beside usernames in messages

### Username and Avatar Management
- Header displays the current username as a clickable button alongside an avatar icon
- Clicking the avatar icon opens an avatar picker dialog with options to:
  - Select from six preset Chattr speech bubble avatars displayed in a grid at the top of the dialog
  - Upload a custom avatar image
  - Remove current avatar (revert to default)
- Preset avatar system includes six colored Chattr speech bubble avatars using provided asset images
- Preset avatars are displayed in a responsive grid layout at the top of the avatar picker dialog
- When a user selects a preset avatar, it immediately updates their avatar locally and persists to the backend user profile
- Avatar selection from presets triggers retroactive message updates using the same system as username changes
- Clicking the username button opens the username edit modal
- Avatar changes apply immediately to the user's display in the header and future messages
- Username changes retroactively update all previously posted messages from that user across all chatrooms
- Preset avatar selection maintains existing upload/remove logic and responsiveness
- All preset avatars render correctly across desktop and mobile views

### Chat Interface (Per Chatroom)
- Clean, modern chat interface with message bubbles specific to each chatroom
- Chatroom header displays the chatroom title, category tags, along with message counter and view counter
- Live indicator in chatroom header shows compact user count formatting (e.g., "2.5k LIVE", "1.2M LIVE") with 1 minute activity timeout
- Counters are displayed visibly near the chatroom title in the header area
- On desktop breakpoint only: room title, description, category tags, likes, and views are centered and evenly spaced horizontally in the header, no longer positioned too far to the left
- Messages displayed in chronological order (oldest to newest) with both regular messages and replies appearing at the bottom of the chat in chronological order
- Auto-scroll behavior automatically scrolls to the newest message after sending or receiving new messages
- Chat layout with proper scrollable message area that maintains fixed header and message input
- Message list container uses flexbox layout with `flex-1`, `h-full`, and `min-h-0` to fill available space
- Message container has `overflow-y-auto` for smooth vertical scrolling without expanding the overall layout
- Header and MessageInput components remain fixed while message list scrolls independently
- Consistent scrollable behavior across all screen sizes maintaining stable layout on both mobile and desktop
- Messages never push past the visible viewport due to constrained container height
- Auto-scroll functionality that works correctly when new messages arrive while maintaining responsive design across different viewports
- ChatroomPage and parent wrappers must define consistent height constraints using `h-full`, `min-h-0`, and `flex flex-col` layout
- Mobile viewport must use `100dvh` instead of `100vh` to properly handle keyboard-related scroll bugs on Safari
- No interfering `overflow-hidden` or percentage-based max-heights that may suppress scrolling functionality
- Verified smooth, independent message scrolling without layout expansion on both desktop and mobile devices
- Pinned video system: videos can be pinned to remain visible at the top of the chat window while messages scroll below
- Pin button appears on video messages allowing users to toggle the pinned state
- Only one video can be pinned at a time per chatroom
- Pinned videos display in a dedicated area above the scrollable message list with responsive sizing:
  - Desktop: Maximum width of 48rem (max-w-xl) and centered horizontally for improved chat visibility
  - Mobile and tablet: Full width responsive scaling for optimal viewing on smaller screens
- Media display within messages with differentiated sizing:
  - Images: Maximum width of 400px with click-to-expand functionality, constrained by message bubble width
  - Videos (YouTube/Twitch): Responsive sizing with maximum width of 600px, maintaining aspect ratio and mobile-friendly scaling, NOT constrained by message bubble width limitations, with pin/unpin button and proper Twitch VOD/clip/stream embedding
  - Twitter posts: Full Twitter embed integration using widgets.js with responsive display, proper aspect ratio, and automatic theme detection (light/dark)
  - All media content scales down appropriately on mobile devices
  - For uploaded images: display inline within the message with size constraints and expandable modal
  - For YouTube/Twitch videos: embed video player using iframe with larger size constraints (600px max-width) that overrides parent container width restrictions, includes pin button, with enhanced Twitch support for VODs, clips, and live streams
  - For Twitter posts: embed Twitter post content using Twitter's official widgets.js with full interactive functionality and responsive styling
- Click-to-expand functionality for images only:
  - Clicking any image opens an expanded modal view
  - Expanded images display in larger size while preserving aspect ratio
  - Modal appears centered with darkened background overlay
  - Close button or clicking outside modal returns to normal chat view
  - Fully responsive expanded view for both mobile and desktop
- Videos and Twitter posts do not have click-to-expand functionality and display at their designated responsive size
- Twitter embed integration with automatic script loading and dynamic rendering using twttr.widgets.load()
- Distinguishable styling for sent vs received messages
- Message input field at the bottom of the chat area with support for text, image uploads, YouTube video URLs, Twitch video URLs, and Twitter post URLs
- Message input interface includes unified Video tab that automatically detects and processes YouTube or Twitch URLs
- Twitter input tab with full URL validation for twitter.com and x.com domains
- Send button with loading animation/indicator to show progress while message is being sent
- Display usernames or anonymous IDs with avatars for each message
- Navigation back to lobby from chat interface
- Responsive media display for both desktop and mobile layouts with consistent alignment between all media types
- Mobile-optimized input layout for iPhone Chrome and Safari with proper keyboard handling
- Timestamp formatting displays relative time without the word "about" in message timestamps

### Telegram-Style Reply System
- Comprehensive reply system with Telegram-style quoted message previews and interactive reply blocks
- Reply button appears on each message for initiating threaded responses
- **Quoted Reply Preview in Message Input:**
  - When replying to a message, display a quoted preview above the message input field
  - Preview includes the original sender's username, truncated content snippet (first 100 characters), and small media thumbnail if the parent message contains image/video
  - Preview shows a close button to cancel the reply and return to normal message input
  - Preview maintains consistent styling with the overall chat interface
- **Reply Display in Message Bubbles:**
  - Reply messages display a smaller "quoted message block" at the top of the message bubble
  - Quoted block includes the original sender's name, content snippet, and small media thumbnail
  - Quoted block has distinct visual styling to differentiate from the main message content
  - Quoted block is clickable and tappable for scroll-to-message functionality
- **Quote Interactivity:**
  - Clicking the quoted message block scrolls the chat to the original message and briefly highlights it
  - Highlight animation draws attention to the referenced message for improved user experience
  - Scroll-to-message functionality works smoothly across all device types and screen sizes
  - Reply functionality supports all message types equally (text, images, videos, Twitter posts)
- **Reply Context Display:**
  - Replying to a message shows "Replying to [username]..." context in the message input area
  - Reply context is visually distinct and provides clear feedback about the reply target
  - Reply chains display beneath parent messages showing clear nesting relationships
  - Reply threads can be collapsed or expanded for better readability
- **Backend Reply Integration:**
  - Backend stores `replyToMessageId` references to maintain thread relationships
  - `sendMessage` endpoint includes reply reference handling for active chat runtime
  - `getMessageWithReactionsAndReplies` endpoint includes reply data in message retrieval
  - Reply notifications and visual indicators for messages with responses
  - Threaded replies maintain chronological order within each thread
- Reply functionality works seamlessly with all existing message features including reactions, media content, and user management
- Reply system maintains responsive design and consistent user experience across desktop and mobile devices
- Replies appear at the bottom of the chat in chronological order alongside regular messages

### Message System and Reactions
- Real-time message sending and receiving within specific chatrooms
- Message persistence across sessions per chatroom
- Display of message timestamps formatted without the word "about"
- Support for text messages, image messages, YouTube video messages, Twitch video messages (including VODs, clips, and live streams), and Twitter post messages with full embed integration
- Messages show sender's username or generated anonymous ID with avatar
- Messages are isolated per chatroom - no cross-room message visibility
- Username updates automatically and retroactively propagate to all existing messages from that user across all chatrooms
- First message in each chatroom is automatically the uploaded media posted by the room creator
- Each new message sent increments the message counter for that chatroom
- Video messages include pin/unpin functionality for chatroom-level video pinning
- Users can post images, YouTube videos, Twitch videos, and Twitter posts directly in chat messages using the message input interface with unified Video tab
- Posted media displays inline with the same responsive sizing and functionality as main media
- Posted images support click-to-expand modal functionality
- Posted videos support inline playback and pinning functionality with enhanced Twitch support for all video types
- Posted Twitter content displays as full embedded tweets using Twitter's widgets.js with interactive functionality
- Twitter embeds automatically load and render when messages are displayed using twttr.widgets.load()
- Emoji reaction system allowing users to react to messages with common emoji
- Optimistic reaction updates: reaction counts update immediately when user clicks, before backend confirmation
- Backend reliably records emoji reactions with correct counts and user tracking
- Live state refresh after backend confirmation ensures reactions display persistently after page reload
- Quick reply functionality for rapid responses to specific messages
- Reaction counts displayed on messages with visual indicators
- Users can add, remove, and view reactions on any message
- Reaction updates continue to work correctly after message ordering changes

### Content Moderation System
- Automatic image moderation to detect and block NSFW visual content
- Automatic text moderation to filter spam, inappropriate language, and harmful content
- Moderated content is blocked before being posted and users receive appropriate feedback
- Moderation applies to both chatroom creation content and chat messages
- Fallback mechanisms for when moderation services are unavailable
- Clear user notifications when content is blocked due to moderation policies
- Moderation covers all media types: images, text, video links, and social media posts

### Video Pinning System
- Users can pin videos in chat to keep them visible at the top of the chat window
- Pin button appears on video messages (YouTube and Twitch) allowing toggle of pinned state
- Only one video can be pinned per chatroom at a time
- Pinned videos display in a dedicated area above the scrollable message area with responsive sizing:
  - Desktop: Maximum width of 48rem (max-w-xl) and centered horizontally for improved chat visibility
  - Mobile and tablet: Full width responsive scaling for optimal viewing on smaller screens
- Pinning a new video automatically unpins the previously pinned video
- Pin state is stored per chatroom and persists across sessions
- Messages continue to scroll normally below the pinned video area
- Supports pinning of both chatroom creation videos and videos posted directly in chat messages

### Twitter/X Embed Integration
- Full Twitter embed support using Twitter's official widgets.js library and oEmbed API
- Automatic detection and validation of Twitter/X URLs (twitter.com and x.com domains)
- Dynamic loading of Twitter's embed script when Twitter content is detected
- Responsive Twitter embed rendering with proper aspect ratio maintenance
- Automatic theme detection and support for both light and dark themes
- Interactive Twitter embeds with full functionality (likes, retweets, replies when available)
- Twitter embeds render dynamically when new tweets are added to chat or room creation
- Proper error handling for invalid or deleted tweets with fallback display
- Twitter embed integration in both MessageBubble component and CreateChatroomDialog
- Automatic refresh of Twitter embeds using twttr.widgets.load() after DOM updates
- Consistent styling and responsive behavior across desktop and mobile devices
- Twitter oEmbed API integration (`https://publish.twitter.com/oembed`) for rich thumbnail previews in lobby display using real Twitter/X post previews from oEmbed data or extracted image URLs

### Twitch Video Enhancement
- Enhanced Twitch video support for VODs, clips, and live streams with proper embedding
- Correct Twitch thumbnail generation using proper URLs:
  - Live streams: `https://static-cdn.jtvnw.net/previews-ttv/live_user_{channel_name}-640x360.jpg`
  - Clips: `https://clips.twitch.tv/{clipSlug}-preview-480x272.jpg`
  - VODs: Proper Twitch API endpoints for VOD thumbnails
- Proper Twitch iframe embedding with responsive sizing and mobile optimization
- Support for all Twitch URL formats including twitch.tv channels, clips.twitch.tv, and VOD URLs
- Real preview thumbnails for Twitch content in lobby display using correct Twitch thumbnail URLs instead of generic placeholders
- Enhanced Twitch video playback in chat messages with proper aspect ratio and controls
- Twitch video pinning functionality with responsive sizing for improved viewing experience

### View Tracking System
- View counter increments when a user opens a chatroom (enters ChatroomPage)
- View count is tracked per chatroom and persisted in backend storage
- View counter is displayed in both lobby cards and chatroom headers
- View tracking occurs on chatroom page load/navigation

### User Activity Tracking System
- Track active users in each chatroom based on recent activity signals
- Activity signals include active viewing (being on the chatroom page) and message posting
- Users are considered active within 60 seconds (1 minute timeout) of their last activity
- Active user count is maintained per chatroom and updated in real-time
- Live status is determined by whether there are any active users currently in the chatroom
- Activity tracking enables the live indicator functionality in the lobby with compact number formatting
- Live user counts display using compact formatting (k for thousands, M for millions)

### Deep Linking and Direct Access
- Support for direct navigation to chatrooms via URL paths (e.g., `/chatroom/:id`)
- Chatroom pages must load correctly on fresh page loads, browser refreshes, and direct URL access without errors or blank pages
- Router configuration supports deep linking to individual chatrooms with proper fallback handling
- Router configuration includes fallback route to `index.html` for deep links during static hosting to ensure client-side routing handles them properly
- Chatroom data fetching initializes properly when accessing chatrooms directly via URL
- ChatroomPage component fetches and renders chatroom data based solely on the URL parameter when no prior state exists
- Backend actor initialization occurs before fetching data when navigating directly to a chatroom page
- Consistent route parameter naming between router paths and component usage
- Fallback data retrieval from backend when chatroom data is not in memory
- Graceful handling of invalid chatroom IDs with appropriate error messaging
- Back navigation and browser history work correctly across all navigation scenarios
- Deep linking functionality works reliably across all browsers and devices without routing errors

### User Experience
- Responsive design that works on desktop and mobile with optimized grid layouts
- Smooth scrolling and message animations
- Clear visual hierarchy and readable typography with specified font sizes for desktop
- Intuitive navigation between lobby and chatrooms
- No login screens or authentication barriers
- Dynamic media thumbnails in lobby using platform-specific APIs (YouTube, correct Twitch URLs, Twitter oEmbed) and consistently sized media in chat messages
- Expandable image viewing with modal overlay for enhanced user experience (images only)
- Videos and social media posts display at larger responsive size without modal expansion
- Video pinning functionality for enhanced viewing experience with responsive sizing for improved chat visibility on desktop
- Full Twitter embed integration with interactive functionality and responsive design
- Enhanced Twitch video support with proper VOD, clip, and live stream embedding using correct thumbnail URLs
- Consistent layout alignment between all media types across all devices
- English language interface
- Graceful error handling and loading states throughout the application
- Clear user feedback when operations fail or when no data is available
- Proper mobile and desktop chat layout with messages contained within scrollable area and fixed header/input components
- Verified scrollable behavior with correct flexbox constraints and mobile viewport handling
- Optimized mobile input experience preventing zoom and maintaining accessibility when keyboard appears
- Reliable deep linking functionality across all browsers and devices
- Responsive lobby grid that transitions smoothly between desktop (7-column) and mobile (2-column) layouts with dynamic thumbnails
- Streamlined username and avatar management with current username displayed as clickable button and avatar icon in header
- Clear display of activity counters (messages and views), category tags including Finance, and live indicators with compact formatting in both lobby and chatroom interfaces
- Page title displays "Chats" instead of "Chatroom Lobby" throughout the application
- Flat, modern lobby design without card borders, shadows, or background colors while preserving functionality
- Centered and evenly spaced chatroom header elements on desktop breakpoint for improved visual balance
- Infinite chatroom support without artificial limits on creation or display
- Consistent timestamp formatting without "about" prefix across all interfaces
- Avatar picker dialog for custom avatar selection and upload with preset avatar grid
- Enhanced message input interface supporting text, image uploads, and unified Video tab with automatic YouTube/Twitch detection
- Real-time live activity indicators that update dynamically as users join, leave, or become inactive with 1 minute timeout
- Live user count displays with compact formatting (e.g., "2.5k LIVE", "1.2M LIVE") for better readability
- Search and filtering functionality for improved chatroom discoverability with persistent input focus, live debounce, and inclusion of Finance category
- Send button loading states and progress indicators for better user feedback
- Emoji reactions with optimistic updates and reliable backend synchronization for enhanced message interaction
- Comprehensive Telegram-style reply system with quoted previews, interactive reply blocks, and smooth scroll-to-message functionality
- Content moderation feedback and user notifications for blocked content
- Preset avatar system with six colored Chattr speech bubble options for quick avatar selection
- Dynamic Twitter embed rendering with automatic script loading and theme detection using oEmbed API
- Dynamic YouTube and correct Twitch thumbnail fetching using platform-specific APIs for improved visual presentation in lobby
- Platform-specific thumbnail generation for accurate media representation in lobby display
- Auto-scroll behavior that automatically scrolls to newest messages after sending or receiving
- Message ordering ensures both regular messages and replies appear at the bottom in chronological order

## Backend Requirements
- Backend canister must be restarted from stopped state to restore full functionality and resolve IC0508 errors
- Canister restart process must preserve existing code and data structures without data loss
- Store chatroom records persistently with unique IDs, topics, descriptions, categories including Finance, media URLs (for uploaded images, YouTube videos, Twitch videos, or Twitter posts), media types, creation timestamps, message counter, view counter, and pinned video ID
- Handle image file uploads up to 10 MB and store uploaded images with generated URLs from blob storage
- Media URL validation that automatically detects and accepts valid blob-storage upload URLs, YouTube URLs, Twitch URLs, and Twitter URLs
- YouTube URL validation for youtube.com and youtu.be links with video ID extraction for thumbnail generation
- Twitch URL validation for twitch.tv and clips.twitch.tv links with video ID extraction for correct thumbnail generation using proper Twitch thumbnail URLs:
  - Live streams: `https://static-cdn.jtvnw.net/previews-ttv/live_user_{channel_name}-640x360.jpg`
  - Clips: `https://clips.twitch.tv/{clipSlug}-preview-480x272.jpg`
  - VODs: Proper Twitch API endpoints for VOD thumbnails
- Twitter URL validation for twitter.com and x.com links with oEmbed API integration support
- Store chat messages persistently per chatroom with sender identification, chatroom association, avatar data, message type (text, image, YouTube video, Twitch video, or Twitter post), and comprehensive reply thread information
- Support Telegram-style threaded replies with `replyToMessageId` field to maintain parent-child message relationships
- Enhanced reply data storage including original message content snippets, sender information, and media thumbnails for quoted reply previews
- Support image messages that contain uploaded image content up to 10 MB
- Support YouTube video messages that contain YouTube video URLs
- Support Twitch video messages that contain Twitch video URLs with enhanced support for VODs, clips, and live streams
- Support Twitter post messages that contain Twitter post URLs
- Automatically create the first message in each chatroom containing the creator's uploaded media when the room is created
- Generate random anonymous IDs for users without custom usernames
- Track user identity across sessions to enable username synchronization for message updates and avatar management
- Store and manage user profiles including username, avatar data (custom uploads and preset selections), and user identity mapping
- Handle preset avatar selection and storage with user profile association
- Provide endpoints for saving and retrieving user profiles including preset avatar selections
- Support retroactive message updates when users change usernames or avatars using existing updateUsernameRetroactively functionality
- Store and manage pinned video state per chatroom (only one pinned video per room, supports YouTube and Twitch)
- Handle video pin/unpin operations and ensure only one video is pinned at a time per chatroom
- Support pinning of both chatroom creation videos and videos posted in chat messages
- Track active users per chatroom based on recent activity signals including viewing and message posting
- Maintain active user presence with timestamp-based activity tracking using 60-second (1 minute) timeout
- Determine live status for each chatroom based on current active user count
- Provide real-time updates for user activity status and live indicators with compact number formatting
- Store user activity timestamps and manage activity expiration for live status determination with 1 minute timeout
- Format live user counts using compact notation (k for thousands, M for millions) for display
- Store chatroom categories including Finance and support category-based filtering and search functionality
- Provide search endpoints for chatrooms by topic, description, and creator username with inclusion of Finance category in filtering
- Store and manage emoji reactions on messages with reaction counts, user associations, and reliable synchronization
- Implement optimistic reaction handling with immediate frontend updates and backend confirmation
- Ensure reaction data persists correctly and displays after page reload
- Provide endpoints for adding, removing, and retrieving reactions with proper user tracking
- Store comprehensive reply thread relationships and provide endpoints for retrieving threaded message structures with full reply data
- Handle Telegram-style reply message creation with proper parent message association and reply preview data
- Enhanced `sendMessage` endpoint to include reply reference handling and emit reply data for active chat runtime
- Enhanced `getMessageWithReactionsAndReplies` endpoint to include comprehensive reply data including original message snippets, sender information, and media thumbnails
- Implement content moderation APIs for automatic image and text filtering
- Content moderation integration to block NSFW images and inappropriate text content
- Moderation validation for all user-generated content including chatroom creation and messages
- Provide endpoints to retrieve chatroom list for lobby display including media URLs, types, categories including Finance, message counters, view counters, live status with compact formatting, and pinned video information
- Provide endpoints to retrieve message history per specific chatroom including all media message types, avatar data, reaction data, and comprehensive threaded reply structures with full reply preview data
- Provide endpoint to retrieve individual chatroom data by ID for deep linking support including pinned video state, category, and live status
- Handle chatroom creation with form data processing, image uploads up to 10 MB, all media URL validation, category assignment including Finance, automatic first message creation, and counter initialization
- Handle message creation and storage with chatroom-specific routing for all message types including avatar data, reaction data, comprehensive reply thread data, and activity tracking
- Handle avatar upload and storage with user association
- Handle preset avatar selection and user profile updates with retroactive message propagation
- Handle user activity tracking including presence updates, activity timestamps with 1 minute timeout, and live status calculations
- Handle emoji reaction operations including adding, removing, and retrieving reactions per message with reliable synchronization
- Handle comprehensive Telegram-style reply operations including reply creation with full preview data, thread retrieval with complete reply information, and parent-child relationship management
- Handle search and filtering operations for chatroom discovery including Finance category
- Increment message counter when new messages are added to a chatroom
- Increment view counter when a chatroom is accessed/opened
- Update user activity status when users view chatrooms or post messages with 1 minute timeout
- Support real-time message updates per chatroom including reaction updates and comprehensive reply thread updates with full preview data
- Handle username updates and retroactively propagate changes to all existing messages from that user across all chatrooms
- Handle video pinning operations and maintain pinned video state per chatroom for YouTube and Twitch videos
- Ensure proper initialization of chatrooms and messages data structures to prevent corruption
- Implement robust error handling in getChatrooms() function to safely return empty arrays when no data exists
- Support unlimited number of chatrooms without artificial limits
- Prevent backend traps and null pointer errors when accessing uninitialized or empty data structures
- Comprehensive error logging and graceful degradation for all backend operations
- Individual chatroom retrieval endpoint must handle invalid IDs gracefully and return appropriate error responses
- No authentication or access control systems
- Backend canister must be properly started and operational to handle all API requests without "Canister is stopped (IC0508)" errors
- Canister restart capability to resolve stopped canister states and restore full functionality while preserving existing data
- Proper canister lifecycle management to prevent service interruptions
- Support dynamic thumbnail generation for YouTube videos using standard YouTube thumbnail URL pattern
- Support dynamic thumbnail generation for Twitch videos using correct Twitch thumbnail URLs:
  - Live streams: `https://static-cdn.jtvnw.net/previews-ttv/live_user_{channel_name}-640x360.jpg`
  - Clips: `https://clips.twitch.tv/{clipSlug}-preview-480x272.jpg`
  - VODs: Proper Twitch API endpoints for VOD thumbnails
- Support dynamic thumbnail generation for Twitter posts using `https://publish.twitter.com/oembed` API to extract preview image or fallback thumbnail
- Provide correct thumbnail URLs for YouTube, Twitch, and Twitter content to frontend for dynamic display in lobby
- Ensure message ordering returns both regular messages and replies in chronological order for proper display at bottom of chat
- Maintain reaction synchronization functionality after message ordering changes

## Data Storage
The backend must store:
- Chatroom records with unique ID, topic, description, category including Finance, media URL (uploaded image, YouTube video, Twitch video, or Twitter post), media type, creation timestamp, message counter, view counter, live status, and pinned video message ID
- Uploaded image files up to 10 MB with accessible URLs from blob storage
- Chat messages with content, timestamp, sender identifier, associated chatroom ID, message type (text, image, YouTube video, Twitch video, or Twitter post), media URL (for media messages), avatar data, reaction data, and comprehensive reply thread information (`replyToMessageId` with full reply preview data)
- Comprehensive Telegram-style reply relationships with parent-child message associations including original message content snippets, sender information, and media thumbnail data for quoted previews
- Image message data including image URLs for messages posted directly in chat (up to 10 MB)
- YouTube video message data including YouTube URLs for messages posted directly in chat
- Twitch video message data including Twitch URLs for messages posted directly in chat with enhanced support for VODs, clips, and live streams
- Twitter post message data including Twitter URLs for messages posted directly in chat
- User identity mapping to enable username synchronization across messages and avatar management
- User profiles including username, avatar data (custom uploads and preset selections), and identity associations
- Preset avatar selection data with user profile associations
- Avatar images with user association and accessible URLs
- User activity data including activity timestamps, chatroom presence, and active status per user per chatroom with 1 minute timeout
- Active user tracking per chatroom with timestamp-based presence management using 60-second timeout
- Live status calculation data for real-time live indicator functionality with compact number formatting
- Pinned video state per chatroom (message ID of pinned video, supporting YouTube and Twitch videos from both creation and chat messages)
- Message history organized by chatroom for conversation continuity with all message types, avatar data, and comprehensive threaded reply structures with full preview data included
- Activity counters (message count and view count) per chatroom with persistent storage
- Chatroom categories including Finance for organization and filtering functionality
- Emoji reaction data per message including reaction types, counts, user associations, and reliable synchronization tracking
- Search index data for efficient chatroom discovery by topic, description, and creator including Finance category
- Content moderation logs and blocked content records for audit purposes
- Properly initialized and maintained data structures that handle empty states gracefully and support unlimited chatrooms
- Persistent data storage that survives canister restarts and redeployments
- No user accounts or authentication data required
- Message ordering data to ensure chronological display of both regular messages and replies at bottom of chat

## Routing and Navigation
- Lobby page serves as the application landing page and chatroom catalog
- Individual chatroom pages accessible via unique chatroom identifiers with consistent URL structure
- Navigation between lobby and specific chatrooms
- URL routing that supports direct links to specific chatrooms with deep linking capability
- Router configuration handles fresh page loads and browser refreshes for chatroom URLs without errors
- Router configuration includes proper fallback route to `index.html` for static hosting compatibility
- ChatroomPage component independently fetches chatroom data based on URL parameter when accessed directly
- Backend actor initialization occurs before data fetching when navigating directly to chatroom pages
- Consistent route parameter naming between router definitions and component implementations
- Fallback mechanisms for accessing chatrooms when data is not preloaded in memory
- Error handling for invalid or non-existent chatroom IDs in URL navigation
- Deep linking works reliably without blank pages or routing errors

## Technical Notes
- Backend canister restart must be implemented to resolve stopped canister state while preserving existing data and functionality
- Messages should be retrieved and displayed in chronological order per chatroom with both regular messages and replies appearing at the bottom of the chat
- Auto-scroll behavior must automatically scroll to newest message after sending or receiving new messages
- Telegram-style threaded replies should maintain chronological order within each thread while preserving parent-child relationships and full reply preview data
- Anonymous IDs should be randomly generated (e.g., "Anon" + 4-digit number)
- Custom usernames persist only in browser localStorage
- Username changes should retroactively update all existing messages from that user across all chatrooms
- Avatar changes apply immediately and persist in browser localStorage
- Preset avatar selection should immediately update user avatar locally and persist to backend user profile
- Avatar updates should instantly propagate to past messages using updateUsernameRetroactively and saveCallerUserProfile from backend
- Chatroom grid should handle responsive layout with smooth transitions between desktop (7-column) and mobile (2-column) layouts with dynamic thumbnails
- The application should handle real-time updates efficiently per chatroom including live status updates, reaction updates, and comprehensive reply thread updates with full preview data
- Media is required for all chatrooms from supported sources: uploaded images (up to 10 MB), valid YouTube URLs, valid Twitch URLs, or valid Twitter URLs
- Categories including Finance are required for all chatrooms and should be selectable from predefined options
- Frontend upload submission flow must correctly pass uploaded blob URL as mediaUrl to backend with 10 MB size validation
- MediaType must be properly set to "image" for image uploads, "youtube" for YouTube URLs, "twitch" for Twitch URLs, and "twitter" for Twitter URLs
- Add logging to verify correct data formatting before calling backend APIs
- Display dynamic thumbnails in lobby using platform-specific APIs: direct images for uploads, YouTube thumbnail API for YouTube videos, correct Twitch thumbnail URLs for Twitch content, `https://publish.twitter.com/oembed` API for Twitter posts
- YouTube thumbnail fetching using standard YouTube thumbnail URL pattern (`https://img.youtube.com/vi/[VIDEO_ID]/hqdefault.jpg`)
- Twitch thumbnail fetching using correct Twitch thumbnail URLs:
  - Live streams: `https://static-cdn.jtvnw.net/previews-ttv/live_user_{channel_name}-640x360.jpg`
  - Clips: `https://clips.twitch.tv/{clipSlug}-preview-480x272.jpg`
  - VODs: Proper Twitch API endpoints for VOD thumbnails
- Twitter thumbnail fetching using `https://publish.twitter.com/oembed` API to extract preview image or fallback thumbnail instead of placeholders
- ChatroomCard component must be updated to display dynamic thumbnails from correct platform-specific APIs instead of generic placeholders
- Fallback thumbnail handling for unsupported or missing media with appropriate placeholder images
- Live indicator badge should be positioned over the thumbnail using the app's theme blue color with compact user count formatting
- Live status should update in real-time as users enter, leave, or become inactive in chatrooms with 1 minute timeout
- Active users are determined by recent activity within 60 seconds including viewing and message posting
- Live user counts should use compact formatting (k for thousands, M for millions) for better readability
- Image content in chat messages should be sized with maximum width of 400px and responsive scaling with click-to-expand modal, constrained by message bubble width
- Video content (YouTube/Twitch) in chat messages should be sized with maximum width of 600px, responsive scaling, pin/unpin button, and no click-to-expand functionality, NOT constrained by message bubble width limitations, with enhanced Twitch support for VODs, clips, and live streams
- Twitter post content should be embedded using Twitter's widgets.js with full interactive functionality and responsive styling appropriate for readability
- Twitter embeds must automatically load Twitter's embed script and use twttr.widgets.load() for dynamic rendering
- Twitter embed integration must support both twitter.com and x.com domains with proper URL validation
- Twitter embeds must be responsive and maintain proper aspect ratio across desktop and mobile devices
- Twitter embeds must support automatic theme detection (light/dark) and render with full interactive functionality
- Videos should maintain proper aspect ratio and be mobile-friendly with enhanced Twitch embedding support
- Embed appropriate media in messages: inline images, iframe YouTube/Twitch players with enhanced Twitch support, or embedded Twitter posts using widgets.js with differentiated size constraints and pin functionality for videos
- Video messages must override or bypass parent container width restrictions to allow full responsive width up to 600px
- Implement click-to-expand modal functionality for images only with centered display and darkened overlay
- Implement video pinning system with dedicated pinned video area above message list for YouTube and Twitch videos with responsive sizing:
  - Desktop: Maximum width of 48rem (max-w-xl) and centered horizontally for improved chat visibility
  - Mobile and tablet: Full width responsive scaling for optimal viewing on smaller screens
- Only one video can be pinned per chatroom at a time
- Pin state must be stored in backend and persist across sessions
- Form handling for chatroom creation with proper validation, category selection including Finance, and automatic first message creation
- Message input interface must support text input, image file uploads up to 10 MB, and unified Video tab with automatic YouTube/Twitch URL detection and processing
- Twitter input tab must support full URL validation for twitter.com and x.com domains with Twitter embed integration
- Unified Video tab automatically detects whether pasted URLs are from YouTube or Twitch and processes them using the correct embedding logic
- Send button must display loading animation/indicator while message is being processed and sent
- Responsive media sizing for dynamic thumbnails using correct platform APIs, lobby display, and in-chat message media across desktop and mobile for all media types
- YouTube/Twitch embed integration with iframe APIs with larger size limitations (600px max-width) that are not constrained by message bubble width, includes pin button, with enhanced Twitch support for all video types
- Twitter embed integration using Twitter's official widgets.js with automatic script loading, dynamic rendering, and responsive styling
- Twitter embeds must render dynamically when new tweets are added using twttr.widgets.load() after DOM updates
- Modal overlay system for expanded image viewing only with responsive design
- Avatar picker dialog system for custom avatar upload and preset selection with six colored Chattr speech bubble avatars
- Preset avatars displayed in responsive grid layout at top of avatar picker dialog
- Preset avatar selection triggers immediate local avatar update and backend user profile persistence
- User activity tracking system with timestamp-based presence management and live status calculation using 1 minute timeout
- Real-time live indicator updates that reflect current active user status per chatroom with compact number formatting
- Search functionality implementation with real-time filtering, category-based search including Finance category, persistent input focus, and live debounce for improved stability and accuracy
- Emoji reaction system with visual indicators, counts, user interaction capabilities, optimistic updates, and reliable backend synchronization
- Reaction updates must continue to work correctly after message ordering changes
- Comprehensive Telegram-style reply system implementation with:
  - Quoted reply preview above message input showing original sender, content snippet (100 characters), and media thumbnail
  - Reply block display in message bubbles with clickable scroll-to-message functionality
  - Smooth scroll animation and message highlighting for referenced messages
  - Reply context display showing "Replying to [username]..." in message input area
  - Backend integration with enhanced `sendMessage` and `getMessageWithReactionsAndReplies` endpoints
  - Full reply data storage including original message snippets, sender information, and media thumbnails
  - Reply functionality support for all message types (text, images, videos, Twitter posts)
  - Responsive design and consistent user experience across desktop and mobile devices
  - Replies appear at bottom of chat in chronological order alongside regular messages
- Content moderation integration with user feedback for blocked content
- ChatArea component must implement proper flexbox layout with message list container using `flex-1`, `h-full`, and `min-h-0` for constrained height
- Message list container must have `overflow-y-auto` for independent scrolling while header, pinned video area, and MessageInput remain fixed
- ChatroomPage and all parent wrappers must use consistent height constraints with `h-full`, `min-h-0`, and `flex flex-col` layout structure
- Mobile viewport must use `100dvh` instead of `100vh` to fix keyboard-related scroll bugs on Safari
- Eliminate any interfering `overflow-hidden` or percentage-based max-heights that suppress scrolling functionality
- Ensure consistent scrollable behavior across all screen sizes maintaining stable layout on both mobile and desktop
- Auto-scroll must function correctly when new messages arrive and automatically scroll to newest message
- Auto-scroll behavior must work after sending or receiving new messages to ensure newest content is visible
- Implement comprehensive error handling in frontend fetch operations to handle failed API calls, invalid JSON responses, and network errors
- Frontend should gracefully handle empty chatroom arrays and display appropriate messaging
- Prevent infinite loading states by implementing proper timeout and error recovery mechanisms
- Backend data structure initialization must be robust and prevent corruption during resets or updates
- All API endpoints must handle edge cases and return valid responses even when no data exists
- Implement proper JSON serialization and deserialization with error checking
- Add comprehensive logging for debugging initialization and data retrieval issues
- Support unlimited chatrooms without artificial pagination or limits
- Verify smooth, independent message scrolling without layout expansion on both desktop and mobile devices through comprehensive testing
- Mobile input optimization for iPhone browsers with proper keyboard handling and send button accessibility
- Router configuration must support consistent URL patterns for chatroom access with proper fallback handling
- ChatroomPage component must initialize actor connection and fetch chatroom data independently when accessed via direct URL
- Route parameter names must be consistent between router path definitions and component parameter usage
- Deep linking functionality must be tested and verified across desktop and mobile browsers without errors
- Fallback data fetching must handle cases where chatroom data is not available in component state
- Error boundaries and graceful degradation for invalid chatroom IDs or failed data retrieval
- Router fallback configuration ensures static hosting compatibility for client-side routing
- Username button in header displays current username/anonymous ID and opens edit modal when clicked
- Avatar icon in header opens avatar picker dialog when clicked
- Remove duplicate username label from header since username is now displayed as the button text
- Implement responsive grid breakpoints for smooth transition between desktop 7-column and mobile 2-column layouts with dynamic thumbnails using correct platform APIs
- Backend canister must be restarted when in stopped state to restore full API functionality and resolve IC0508 errors while preserving existing data
- Canister lifecycle management ensures continuous service availability and proper error recovery
- Activity counters (message and view counts), category tags including Finance, and live indicators with compact formatting must be displayed responsively in both lobby cards and chatroom headers
- Counter incrementation must be handled atomically to prevent race conditions
- View counter increments on chatroom page access, message counter increments on message creation
- User activity tracking must update when users view chatrooms or post messages with 1 minute timeout
- All UI text references to "Chatroom Lobby" should be changed to "Chats" for consistent labeling
- Create button text should display "Create Chat" while maintaining the plus icon
- Counter display, category tags including Finance, and live indicators with compact formatting should be clear and readable on both desktop and mobile layouts
- Lobby chatroom items must have flat, modern styling without card borders, shadows, or background colors across both desktop and mobile
- Live indicator badge must integrate seamlessly with the existing flat design aesthetic with compact user count formatting
- Chatroom header elements (title, description, category, likes, views) must be centered and evenly spaced horizontally on desktop breakpoint only
- Preserve hover states, thumbnails, and grid responsiveness while implementing the flatter visual design
- Desktop typography: chatroom titles use 1rem font size, descriptions/counters/timestamps use 0.875rem font size
- Timestamp formatting removes "about" prefix from relative time displays (e.g., "2 hours ago" not "about 2 hours ago")
- Retroactive username updates must propagate to all existing messages across all chatrooms when username is changed
- Avatar picker must support both custom image upload and preset avatar selection with six colored Chattr speech bubble options
- Preset avatar grid must be displayed at the top of the avatar picker dialog with responsive layout
- All preset avatars must render correctly across desktop and mobile views
- Pinned video area must be visually distinct and positioned above the scrollable message list with responsive sizing for improved chat visibility
- Pin button styling should be clear and accessible on video messages (YouTube and Twitch)
- Message input must support multiple content types: text, image uploads (up to 10 MB), and unified Video tab with automatic YouTube/Twitch detection
- Twitter input tab must provide full Twitter embed integration with URL validation and dynamic rendering
- Posted media in chat messages must use the same responsive sizing and functionality as main media
- Video pinning must work for both chatroom creation videos and videos posted directly in chat messages (YouTube and Twitch only)
- Telegram-style reply functionality must be intuitive and clearly show parent-child message relationships with full quoted previews
- Reply context display must show "Replying to [username]..." above message input when replying
- Reply threads must be visually distinct and properly nested beneath parent messages
- Quoted reply previews must include original sender username, content snippet (100 characters), and media thumbnails
- Reply blocks in message bubbles must be clickable with smooth scroll-to-message and highlight functionality
- Live indicator functionality must work reliably across all browsers and devices with real-time updates and 1 minute timeout
- Live user count formatting must use compact notation (k for thousands, M for millions) consistently across lobby and chatroom interfaces
- Search functionality must provide real-time results with persistent input focus, live debounce, and work seamlessly with category filtering including Finance category
- Emoji reactions must be visually appealing, provide clear user feedback, update optimistically, and synchronize reliably with backend
- Reaction counts must persist correctly after page reload and display accurate user interaction data
- Content moderation must provide clear user feedback when content is blocked
- Send button loading states must be visually clear and provide appropriate user feedback during message processing
- All new media types (enhanced Twitch videos and Twitter posts) must integrate seamlessly with existing responsive design and functionality
- Twitter embed integration must be fully functional with automatic script loading, dynamic rendering, and theme support using oEmbed API
- Twitter embeds must render correctly in both MessageBubble component and CreateChatroomDialog with consistent styling
- Twitter URL detection must work for both twitter.com and x.com domains with proper validation
- Twitter embeds must use twttr.widgets.load() for dynamic rendering after DOM updates and new message additions
- Twitter embeds must be responsive and maintain proper aspect ratio across all device sizes
- Twitter embeds must support interactive functionality (likes, retweets, replies when available)
- Error handling for invalid or deleted tweets must provide appropriate fallback display
- Twitch video embedding must support VODs, clips, and live streams with proper iframe integration and responsive sizing
- Twitch thumbnail generation must use correct Twitch thumbnail URLs for lobby display instead of generic placeholders
- Twitch video support must work reliably across all supported Twitch URL formats
- Enhanced Twitch embedding must maintain proper aspect ratio and mobile optimization
- Platform-specific thumbnail generation must be implemented for YouTube (standard API), Twitch (correct preview URLs), and Twitter (oEmbed data or extracted image URLs)
- Dynamic thumbnail fetching must be efficient and include proper error handling with fallback images
- All platform APIs must be integrated with proper rate limiting and error recovery mechanisms
- 10 MB image upload limit must be enforced consistently across frontend validation and backend processing
- Header component logo icon and title text must have exactly 0.5rem spacing between them
- Logo-to-title spacing must be consistent and responsive across mobile and desktop breakpoints
- Header spacing adjustment must not affect positioning or layout of other header elements (navigation buttons, avatar, username button, etc.)
- Preset avatar system must maintain existing upload/remove logic and responsiveness while adding six colored Chattr speech bubble options
- Avatar selection from presets must trigger retroactive message updates using updateUsernameRetroactively and saveCallerUserProfile from backend
- Preset avatar selection must immediately update avatar locally and persist to backend user profile
- Unified Video tab in both CreateChatroomDialog and MessageInput must automatically detect YouTube or Twitch URLs and process them with appropriate embedding logic
- Video tab maintains consistent validation, preview, and progress tracking behavior for all video links
- Automatic URL detection preserves existing YouTube and Twitch functionality while providing unified user interface
- Twitter tab integration must be seamless and consistent across both CreateChatroomDialog and MessageInput components
- Twitter embed functionality must work reliably across all supported browsers and devices
- Twitter widgets.js integration must handle script loading, initialization, and dynamic rendering efficiently
- Twitter embed theme detection must work automatically and support both light and dark themes appropriately
- Dynamic thumbnail fetching must be implemented for YouTube videos using standard YouTube thumbnail URL pattern
- Dynamic thumbnail fetching must be implemented for Twitch videos using correct Twitch thumbnail URLs instead of generic placeholders
- Dynamic thumbnail fetching must be implemented for Twitter posts using `https://publish.twitter.com/oembed` API to extract preview image or fallback thumbnail instead of placeholders
- ChatroomCard component must display fetched thumbnails from correct platform APIs instead of generic placeholders
- Fallback mechanisms must be in place for unsupported or missing media thumbnails with appropriate placeholder images
- Thumbnail fetching must be efficient and not impact application performance with proper caching and error handling
- Error handling for failed thumbnail requests must provide appropriate fallback images and graceful degradation
- Platform-specific API integration must include proper authentication, rate limiting, and error recovery where required
- All media platform integrations must be tested thoroughly across desktop and mobile devices for consistent functionality
- Category system must include Finance as available option in both chatroom creation and filtering interfaces
- Search functionality must include Finance category in filtering and search operations with persistent input focus and live debounce
- All category-related functionality must support the Finance category seamlessly
- Emoji reaction system must implement optimistic updates for immediate user feedback
- Backend reaction synchronization must be reliable and ensure data persistence across sessions
- Live state refresh after backend confirmation must ensure reactions display correctly after page reload
- Comprehensive Telegram-style reply system must store `replyToMessageId` references and full reply preview data in backend for proper thread relationships
- Reply UI must show clear visual nesting, quoted previews with content snippets and media thumbnails, and "Replying to [username]..." context
- Reply functionality must work with all message types (text, images, videos, Twitter posts) and include smooth scroll-to-message with highlighting
- Reply threads must maintain chronological order within each thread structure while preserving full reply preview data
- Enhanced backend endpoints must support comprehensive reply data including original message snippets, sender information, and media thumbnails for Telegram-style functionality
- Message ordering must ensure both regular messages and replies appear at the bottom of the chat in chronological order
- Auto-scroll behavior must automatically scroll to newest message after sending or receiving new messages
- Reaction functionality must continue to work correctly after message ordering changes are implemented
- All updates must be fully tested before deployment to ensure proper functionality
